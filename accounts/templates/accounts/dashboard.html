<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - End2Friend</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=chat,dashboard,draft,drone_2,groups,logout,person,schedule,settings" />
</head>

<body class="varela-round-regular">
    <div class="flex min-h-screen bg-purple-50">

        <!-- Sidebar -->
        <aside class="w-56 bg-white shadow-md flex flex-col">

            <!-- Logo -->
            <div class="p-5 flex items-center gap-2 text-purple-600 border-b border-purple-100">
                <span class="material-symbols-outlined">drone_2</span>
                <h1 class="font-bold text-lg">End2Friend</h1>
            </div>

            <!-- User -->
            <div class="p-5 flex items-center gap-3 border-b border-purple-100">
                <div class="w-10 h-10 bg-purple-200 rounded-full flex items-center justify-center">
                    <span class="material-symbols-outlined text-purple-600">person</span>
                </div>
                <span class="text-gray-700 text-sm">{{ user.username }}</span>
            </div>

        <!-- Nav Links -->
<nav class="flex-1 p-4">
    <a href="{% url 'dashboard' %}" class="nav-link active">
        <span class="material-symbols-outlined">dashboard</span>
        Dashboard
    </a>
    <a href="{% url 'people' %}" class="nav-link">
        <span class="material-symbols-outlined">person</span>
        People
    </a>
    <a href="{% url 'profile' %}" class="nav-link">
        <span class="material-symbols-outlined">person</span>
        Profile
    </a>
    <a href="{% url 'inbox' %}" class="nav-link">
        <span class="material-symbols-outlined">chat</span>
        Messages
    </a>
    <a href="#" class="nav-link">
        <span class="material-symbols-outlined">settings</span>
        Settings
    </a>
</nav>

            <!-- Logout -->
            <div class="p-4 border-t border-purple-100">
                <a href="{% url 'logout' %}" class="nav-link text-red-400 hover:bg-red-50">
                    <span class="material-symbols-outlined">logout</span>
                    Log out
                </a>
            </div>

        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8">

            <!-- Greeting Header -->
            <header class="mb-8">
                <p class="text-sm text-purple-500 mb-1">{% now "l, F j, Y" %}</p>
                <h1 class="text-2xl font-bold text-gray-800">Welcome back, {{ user.username }}</h1>
                <p class="text-gray-500 mt-1">Stay focused. Finish strong.</p>
            </header>

            <!-- Tasks & Reminders Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                <!-- Today's Tasks Card -->
                <div class="bg-white rounded-xl shadow p-6">
                    <h2 class="text-lg font-bold text-gray-800 mb-4">Today's Tasks</h2>

                    <ul class="space-y-3">
                        {% for task in tasks %}
                        <li class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <input type="checkbox" class="w-4 h-4 accent-purple-600" {% if task.completed %}checked{% endif %}>
                            <span class="w-2 h-2 rounded-full
                                {% if task.priority == 'high' %}bg-red-500
                                {% elif task.priority == 'medium' %}bg-yellow-500
                                {% else %}bg-green-500{% endif %}">
                            </span>
                            <div class="flex-1">
                                <p class="text-gray-800 text-sm">{{ task.title }}</p>
                                <p class="text-xs text-gray-400">{{ task.channel }} · Due {{ task.due_date|date:"M j" }}</p>
                            </div>
                        </li>
                        {% empty %}
                        <li class="text-center text-gray-400 text-sm py-4">No tasks yet. You're all caught up!</li>
                        {% endfor %}
                    </ul>

                    <form method="POST" class="flex flex-wrap gap-2 mt-4 items-center">
                        {% csrf_token %}
                        {{ form.title }}
                        {{ form.due_date }}
                        {{ form.priority }}
                        {{ form.channel }}
                        <button type="submit" name="add_task"
                            class="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700">
                            + Add Task
                        </button>
                    </form>
                </div>

                <!-- Upcoming Reminders Card -->
                <div class="bg-white rounded-xl shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-bold text-gray-800">Upcoming Reminders</h2>
                        <a href="#" class="text-sm text-purple-600 hover:text-purple-800">View all</a>
                    </div>

                    <ul class="space-y-3">
                        {% for reminder in reminders %}
                        <li class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                <span class="material-symbols-outlined text-purple-600 text-sm">schedule</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-gray-800 text-sm font-medium">{{ reminder.title }}</p>
                                <p class="text-xs text-gray-400">{{ reminder.remind_at|date:"M j, g:i A" }} · {{ reminder.channel }}</p>
                            </div>
                        </li>
                        {% empty %}
                        <li class="text-center text-gray-400 text-sm py-4">No upcoming reminders.</li>
                        {% endfor %}
                    </ul>
                </div>

            </div>

            <!-- Active Channels Card -->
            <div class="bg-white rounded-xl shadow p-6 mt-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-gray-800">Active Channels</h2>
                    <a href="#" class="text-sm text-purple-600 hover:text-purple-800">View all</a>
                </div>

                <ul class="space-y-3">
                    {% for channel in channels %}
                    <li>
                        <a href="{% url 'chat_room' channel.name %}"
                            class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-purple-50 cursor-pointer transition">
                            <div class="w-8 h-8 bg-purple-200 rounded-full flex items-center justify-center">
                                <span class="material-symbols-outlined text-purple-600 text-sm">chat</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-gray-800 text-sm font-medium">#{{ channel.name }}</p>
                                <p class="text-xs text-gray-400">Last active {{ channel.last_activity|timesince }} ago</p>
                            </div>
                            {% if channel.unread_count > 0 %}
                            <span class="bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded-full">
                                {{ channel.unread_count }}
                            </span>
                            {% endif %}
                        </a>
                    </li>
                    {% empty %}
                    <li class="text-center text-gray-400 text-sm py-4">No channels joined yet.</li>
                    {% endfor %}
                </ul>

                <!-- Create Channel Form -->
                <form method="POST" class="flex gap-2 mt-4">
                    {% csrf_token %}
                    {{ channel_form.name }}
                    <button type="submit" name="create_channel"
                        class="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700">
                        + New Channel
                    </button>
                </form>
            </div>

    <!-- Pomodoro Status Card -->
    <div class="bg-white rounded-xl shadow p-6 mt-6 max-w-md mx-auto">
        <h2 class="text-lg font-bold text-gray-800 mb-4 text-center">Pomodoro Timer</h2>

                <div class="flex flex-col items-center gap-4">

                    <!-- Circular Indicator -->
                    <div class="relative w-28 h-28">
                        <svg class="w-28 h-28 transform -rotate-90">
                            <circle cx="56" cy="56" r="50" stroke="#e9d5ff" stroke-width="8" fill="none"></circle>
                            <circle id="pomo-progress" cx="56" cy="56" r="50" stroke="#a855f7" stroke-width="8"
                                fill="none" stroke-dasharray="314" stroke-dashoffset="314"
                                stroke-linecap="round"></circle>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="pomo-time" class="text-lg font-bold text-gray-700">25:00</span>
                        </div>
                    </div>

            <!-- Status -->
            <div class="text-center">
                <p class="text-sm text-gray-500 mb-1">Status</p>
                <p id="pomo-status" class="text-gray-800 font-medium">Not started</p>
            </div>

                    <!-- Buttons -->
                    <div class="flex gap-2">
                        <button id="pomo-btn" onclick="togglePomodoro()"
                            class="px-5 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 transition">
                            Start
                        </button>
                        <button id="pomo-reset" onclick="resetPomodoro()"
                            class="px-5 py-2 bg-gray-200 text-gray-600 rounded-lg text-sm hover:bg-gray-300 transition">
                            Reset
                        </button>
                    </div>

                </div>
            </div>

    <!-- Activity & Study Rooms Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">

                <!-- Recent Activity Card -->
                <div class="bg-white rounded-xl shadow p-6">
                    <h2 class="text-lg font-bold text-gray-800 mb-4">Recent Activity</h2>

                    <ul class="space-y-3">
                        {% for activity in activities %}
                        <li class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                {% if activity.activity_type == 'mention' %}
                                <span class="material-symbols-outlined text-purple-600 text-sm">person</span>
                                {% elif activity.activity_type == 'file' %}
                                <span class="material-symbols-outlined text-purple-600 text-sm">draft</span>
                                {% else %}
                                <span class="material-symbols-outlined text-purple-600 text-sm">chat</span>
                                {% endif %}
                            </div>
                            <div class="flex-1">
                                {% if activity.activity_type == 'mention' %}
                                <p class="text-gray-800 text-sm">You were mentioned in <span class="font-medium">{{ activity.channel }}</span></p>
                                {% elif activity.activity_type == 'file' %}
                                <p class="text-gray-800 text-sm">New file uploaded in <span class="font-medium">{{ activity.channel }}</span></p>
                                {% else %}
                                <p class="text-gray-800 text-sm">{{ activity.count }} new messages in <span class="font-medium">{{ activity.channel }}</span></p>
                                {% endif %}
                                <p class="text-xs text-gray-400">{{ activity.created_at|timesince }} ago</p>
                            </div>
                        </li>
                        {% empty %}
                        <li class="text-center text-gray-400 text-sm py-4">No recent activity.</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Study Rooms Card -->
                <div class="bg-white rounded-xl shadow p-6">
                    <h2 class="text-lg font-bold text-gray-800 mb-4">Study Rooms</h2>

                    <ul class="space-y-3">
                        {% for room in study_rooms %}
                        <li class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <div class="w-8 h-8 bg-purple-200 rounded-full flex items-center justify-center">
                                <span class="material-symbols-outlined text-purple-600 text-sm">groups</span>
                            </div>
                            <div class="flex-1">
                                <p class="text-gray-800 text-sm font-medium">{{ room.name }}</p>
                                <p class="text-xs text-gray-400">
                                    {% if room.active_count > 0 %}
                                    {{ room.active_count }} member{{ room.active_count|pluralize }} studying now
                                    {% else %}
                                    No one active
                                    {% endif %}
                                </p>
                            </div>
                            <button class="px-3 py-1 bg-purple-600 text-white rounded-lg text-xs hover:bg-purple-700 transition">
                                Join
                            </button>
                        </li>
                        {% empty %}
                        <li class="text-center text-gray-400 text-sm py-4">No study rooms joined.</li>
                        {% endfor %}
                    </ul>
                </div>

            </div>

        </main>

    </div>

    <script>
        const WORK_DURATION = 25 * 60;
        const BREAK_DURATION = 5 * 60;

        let timeLeft = WORK_DURATION;
        let isRunning = false;
        let isBreak = false;
        let timerInterval = null;
    <script>
        const WORK_DURATION = 25 * 60;
        const BREAK_DURATION = 5 * 60;

        let timeLeft = WORK_DURATION;
        let isRunning = false;
        let isBreak = false;
        let timerInterval = null;

        const progressCircle = document.getElementById('pomo-progress');
        const timeDisplay = document.getElementById('pomo-time');
        const statusText = document.getElementById('pomo-status');
        const toggleBtn = document.getElementById('pomo-btn');
        const circumference = 314;
        const progressCircle = document.getElementById('pomo-progress');
        const timeDisplay = document.getElementById('pomo-time');
        const statusText = document.getElementById('pomo-status');
        const toggleBtn = document.getElementById('pomo-btn');
        const circumference = 314;

        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            const totalDuration = isBreak ? BREAK_DURATION : WORK_DURATION;
            const progress = timeLeft / totalDuration;
            progressCircle.style.strokeDashoffset = circumference * progress;
            progressCircle.style.stroke = isBreak ? '#f5b4e0ff' : '#a855f7';
        }

        function updateStatus() {
            if (!isRunning && timeLeft === (isBreak ? BREAK_DURATION : WORK_DURATION)) {
                statusText.textContent = isBreak ? 'Break ready' : 'Not started';
                toggleBtn.textContent = 'Start';
            } else if (isRunning) {
                const minutes = Math.floor(timeLeft / 60);
                statusText.textContent = isBreak ? 'Break in progress' : `${minutes} minutes remaining`;
                toggleBtn.textContent = 'Pause';
            } else {
                const minutes = Math.floor(timeLeft / 60);
                statusText.textContent = `Paused - ${minutes}m left`;
                toggleBtn.textContent = 'Resume';
            }
        }
        function updateStatus() {
            if (!isRunning && timeLeft === (isBreak ? BREAK_DURATION : WORK_DURATION)) {
                statusText.textContent = isBreak ? 'Break ready' : 'Not started';
                toggleBtn.textContent = 'Start';
            } else if (isRunning) {
                const minutes = Math.floor(timeLeft / 60);
                statusText.textContent = isBreak ? 'Break in progress' : `${minutes} minutes remaining`;
                toggleBtn.textContent = 'Pause';
            } else {
                const minutes = Math.floor(timeLeft / 60);
                statusText.textContent = `Paused - ${minutes}m left`;
                toggleBtn.textContent = 'Resume';
            }
        }

        function togglePomodoro() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
            } else {
                isRunning = true;
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateDisplay();
                    updateStatus();

                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        isRunning = false;

                        if (isBreak) {
                            isBreak = false;
                            timeLeft = WORK_DURATION;
                            statusText.textContent = 'Break complete! Ready to focus.';
                        } else {
                            isBreak = true;
                            timeLeft = BREAK_DURATION;
                            statusText.textContent = 'Great work! Take a break.';
                        }

                        toggleBtn.textContent = 'Start';
                        updateDisplay();
                    }
                }, 1000);
            }
            updateStatus();
        }

        function resetPomodoro() {
            clearInterval(timerInterval);
            isRunning = false;
            isBreak = false;
            timeLeft = WORK_DURATION;
            updateDisplay();
            updateStatus();
        }
        function resetPomodoro() {
            clearInterval(timerInterval);
            isRunning = false;
            isBreak = false;
            timeLeft = WORK_DURATION;
            updateDisplay();
            updateStatus();
        }

        updateDisplay();
        updateStatus();
    </script>

    <style>
        .varela-round-regular {
            font-family: "Varela Round", sans-serif;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            color: #6b7280;
            text-decoration: none;
            margin-bottom: 4px;
        }

        .nav-link:hover {
            background: #f3e8ff;
            color: #7c3aed;
        }

        .nav-link.active {
            background: #ede9fe;
            color: #7c3aed;
        }
    </style>

</body>
</html>